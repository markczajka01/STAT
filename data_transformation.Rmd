---
title: "data_transformation"
author: "Group"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
# Default knitting options
knitr::opts_chunk$set(echo=TRUE, # Echo the code
                      tidy=TRUE, # Nicely dity up code
                      warning=FALSE, # No warnings please 
                      message=FALSE) # No messages please

options(warn=-1) 

# Suppress start up warnings when loading libraries
library <- function(...) {
  suppressPackageStartupMessages(base::library(...))
}
```

```{r libraries}
# Load in all libraries
library(tidyverse)
library(here)      # directory referencing
```


```{r creating model data set}
load(file = here("data", "tech_data.Rdata"))

required_columns <- c(
            'LDLNTR',
            'LDLRESB',
            'WHOLGR1N',
            'REFGRA1N',
            'SYSTOL',
            'SLPTIME',
            'BMISC',
            'AGEC',
            'EIBMR1')

model_data <-  
  tech_nutr %>%
  inner_join(tech_biom, by = "ABSPID") %>% 
  select(required_columns) %>% 
  filter(AGEC >= 18,
         # dropping observations below Goldberg cut-off
         EIBMR1 >= 0.9) %>% 
  mutate(LDLNTR = droplevels(LDLNTR)) 

# dropping observations with NA for any variable, leaves us with 2424 rows
model_data <- model_data %>% drop_na()
```


```{r saving model data set to data directory}

save(model_data, file = here("data", "model_data.Rdata"))

```

